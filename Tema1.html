<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Derecho Civil Familia</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --text:#111827;
  --muted:#6b7280;
  --bd:rgba(17,24,39,.12);
  --bg:#ffffff;
  --pillbg:#f3f4f6;
  --pillbd:#e5e7eb;

  --prioBg:#eff6ff;
  --prioBd:#60a5fa;

  --ideaBg:#f5f3ff;
  --ideaBd:#a78bfa;

  --quizBg:#fff7ed;
  --quizBd:#fb923c;

  --okBg:#ecfdf5;
  --okBd:#34d399;

  --badBg:#fef2f2;
  --badBd:#f87171;

  --btnBg:#111827;
  --btnTxt:#ffffff;
  --btnBg2:#0b1220;
}

body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:var(--bg);
  color:var(--text);
}
.wrap{ max-width:1000px; margin:30px auto; padding:0 16px 60px }
h1{ margin:0 0 10px }
.small{ font-size:12px; opacity:.8; color:var(--muted) }

details{
  border:1px solid var(--bd);
  border-radius:14px;
  margin-bottom:12px;
  overflow:hidden;
}
summary{
  cursor:pointer;
  padding:14px 16px;
  font-weight:800;
  list-style:none;
  display:flex;
  gap:10px;
  align-items:flex-start;
  justify-content:flex-start;   /* ðŸ”§ no space-between */
}
.sumLeft{
  display:flex;
  gap:10px;
  align-items:flex-start;
  min-width:0;
  flex:1 1 auto;                /* ðŸ”§ ocupa el ancho */
}
.sumTitle{
  min-width:0;
  white-space:normal;           /* ðŸ”§ permite saltos */
  overflow:visible;             /* ðŸ”§ no recorta */
  text-overflow:clip;           /* ðŸ”§ no pone â€¦ */
  word-break:break-word;
  line-height:1.25;
}

.pill{
  font-size:12px;
  padding:3px 8px;
  border-radius:999px;
  background:var(--pillbg);
  border:1px solid var(--pillbd);
  font-weight:800;
  white-space:nowrap;
}

.tag{
  font-size:11px;
  text-transform:uppercase;
  font-weight:800;
  letter-spacing:.1em;
  margin-bottom:6px;
}

.prio{
  background:var(--prioBg);
  border-left:5px solid var(--prioBd);
  padding:14px;
  border-radius:12px;
  margin-top:14px;
}
.idea{
  background:var(--ideaBg);
  border-left:5px solid var(--ideaBd);
  padding:14px;
  border-radius:12px;
  margin-top:14px;
  font-weight:650;
}
.quizBox{
  background:var(--quizBg);
  border-left:5px solid var(--quizBd);
  padding:14px;
  border-radius:12px;
  margin-top:14px;
}

.rowActions{
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
  margin-top:12px;
}

.btn{
  appearance:none;
  border:1px solid rgba(17,24,39,.15);
  background:transparent;
  padding:8px 10px;
  border-radius:10px;
  font-weight:800;
  cursor:pointer;
  color:var(--text);
}
.btn:hover{ background:rgba(17,24,39,.04) }

.btnPrimary{
  background:var(--btnBg);
  color:var(--btnTxt);
  border:1px solid rgba(17,24,39,.10);
}
.btnPrimary:hover{ background:var(--btnBg2) }

.badge{
  font-size:12px;
  font-weight:800;
  color:var(--muted);
}

p{ margin:0 0 10px; line-height:1.6; white-space:pre-wrap }

/* ===========================
   MODAL QUIZ
=========================== */
.modalOverlay{
  position:fixed;
  inset:0;
  background:rgba(17,24,39,.55);
  display:none;
  align-items:center;
  justify-content:center;
  padding:18px;
  z-index:9999;
}
.modalOverlay.show{ display:flex; }

.modal{
  width:min(860px, 100%);
  background:#fff;
  border-radius:16px;
  border:1px solid rgba(17,24,39,.12);
  box-shadow: 0 20px 60px rgba(0,0,0,.25);
  overflow:hidden;
}
.modalHeader{
  padding:14px 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  border-bottom:1px solid rgba(17,24,39,.10);
  background:linear-gradient(to bottom, rgba(17,24,39,.03), rgba(17,24,39,0));
}
.modalHeader .left{
  display:flex;
  gap:10px;
  align-items:center;
  min-width:0;
}
.modalHeader .title{
  font-weight:900;
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.modalHeader .right{
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
}
.timerPill{
  font-size:12px;
  padding:3px 8px;
  border-radius:999px;
  border:1px solid rgba(17,24,39,.12);
  background:rgba(17,24,39,.04);
  font-weight:900;
}

.modalBody{ padding:16px; }
.qText{
  font-weight:900;
  font-size:16px;
  margin-bottom:12px;
}
.opts{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.optBtn{
  text-align:left;
  border:1px solid rgba(17,24,39,.12);
  background:#fff;
  border-radius:12px;
  padding:12px 12px;
  cursor:pointer;
  font-weight:750;
}
.optBtn:hover{ background:rgba(17,24,39,.03) }
.optBtn .k{
  display:inline-flex;
  width:26px;
  height:26px;
  border-radius:999px;
  align-items:center;
  justify-content:center;
  margin-right:10px;
  border:1px solid rgba(17,24,39,.10);
  background:rgba(17,24,39,.04);
  font-weight:900;
}
.feedback{
  margin-top:14px;
  padding:12px;
  border-radius:12px;
  border-left:5px solid transparent;
  display:none;
}
.feedback.show{ display:block; }
.feedback.ok{ background:var(--okBg); border-left-color:var(--okBd); }
.feedback.bad{ background:var(--badBg); border-left-color:var(--badBd); }

.explicacion{
  margin-top:8px;
  font-size:13px;
  opacity:.9;
}

.modalFooter{
  padding:14px 16px;
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  border-top:1px solid rgba(17,24,39,.10);
  flex-wrap:wrap;
}
.modalFooter .left{
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
}
kbd{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  font-size:12px;
  padding:2px 6px;
  border-radius:8px;
  border:1px solid rgba(17,24,39,.15);
  background:rgba(17,24,39,.04);
}
.scoreLine{
  font-size:12px;
  color:var(--muted);
  font-weight:800;
}

/* Caja de error visible */
.errBox{
  display:none;
  margin-top:12px;
  padding:12px;
  border-radius:12px;
  background:#fef2f2;
  border-left:5px solid #f87171;
  color:#111827;
  font-weight:800;
}
.errBox.show{ display:block; }

/* DiagnÃ³stico */
.diag{
  margin-top:12px;
  padding:12px;
  border:1px solid rgba(17,24,39,.12);
  border-radius:12px;
  background:rgba(17,24,39,.02);
  font-size:12px;
  color:var(--muted);
  font-weight:800;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.diag b{ color:#111827; }
</style>
</head>

<body>
<div class="wrap">
  <h1 id="tituloTema">CapÃ­tulo 1 â€“ El Derecho de familia</h1>
  <div class="small"> by M.GarcÃ­a</div>

  <div id="errBox" class="errBox"></div>
  <div id="diag" class="diag">DiagnÃ³stico: <b>cargandoâ€¦</b></div>

  <div class="rowActions" style="margin-top:12px">
    <button class="btn btnPrimary" id="btnTemaRandom" type="button">Realiza test por tema</button>

    <label class="badge" style="display:flex; gap:8px; align-items:center;">
      NÂº preguntas
      <select id="selTemaN" class="btn" style="padding:6px 10px;">
        <option value="10">10</option>
        <option value="20" selected>20</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
    </label>

    <button class="btn" id="btnSoloFalladas" type="button">Solo falladas</button>
    <button class="btn" id="btnResetStats" type="button">Reiniciar stats</button>
    <span class="badge" id="badgeTemaTotal">0 preguntas cargadas</span>
  </div>

  <div id="contenido" style="margin-top:14px"></div>
</div>

<!-- MODAL -->
<div id="modalOverlay" class="modalOverlay" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal">
    <div class="modalHeader">
      <div class="left">
        <span id="modalPill" class="pill">â€”</span>
        <div class="title" id="modalTitle">Pregunta</div>
      </div>
      <div class="right">
        <span class="timerPill" id="modalTimer">00:00</span>
        <button class="btn" id="btnCloseModal" type="button">Cerrar</button>
      </div>
    </div>

    <div class="modalBody">
      <div class="qText" id="modalQuestion">â€”</div>
      <div class="opts" id="modalOptions"></div>

      <div id="modalFeedback" class="feedback">
        <div id="modalFeedbackTitle" style="font-weight:900"></div>
        <div class="explicacion" id="modalExplanation"></div>
      </div>
    </div>

    <div class="modalFooter">
      <div class="left">
        <button class="btn btnPrimary" id="btnNextQuestion" type="button">Siguiente</button>
        <button class="btn" id="btnBlank" type="button">Dejar en blanco</button>
        <span class="badge" id="modalCounter">0/0</span>
      </div>
      <div>
        <div class="scoreLine" id="scoreLine">Aciertos 0 Â· Fallos 0 Â· Blancos 0 Â· Puntos 0.00 (de 0)</div>
        <div class="small">Atajos: <kbd>Esc</kbd> cerrar Â· <kbd>Enter</kbd> siguiente</div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const errBox = document.getElementById("errBox");
  const diag = document.getElementById("diag");

  function showErr(msg){
    if(!errBox) return;
    errBox.textContent = msg;
    errBox.classList.add("show");
  }

  window.addEventListener("error", (e)=>{
    showErr("Error JS: " + (e.message || "desconocido"));
  });

  try{
    /* =========================
       âœ… PUNTUACIÃ“N (UNA SOLA VEZ)
    ========================= */
    const SCORE_OK = 0.5;
    const SCORE_BAD = 0.20;   // resta
    const SCORE_BLANK = 0;    // no suma ni resta

    /* =========================================================
       1) TEXTO BASE (tu PDF pegado)
    ========================================================= */
    const PDF_TEXTO = `
1. LA FAMILIA Y EL PARENTESCO EN GENERAL
La familia es un dato prenormativo, anterior al Derecho, que existe como instituciÃ³n social
antes de su regulaciÃ³n jurÃ­dica. El Derecho de familia no crea la familia, sino que la regula,
convirtiÃ©ndola en instituciÃ³n jurÃ­dica.
La configuraciÃ³n de la familia ha sido histÃ³ricamente variable, condicionada por factores
sociales, morales, histÃ³ricos y culturales, lo que ha dado lugar a formas familiares diversas
segÃºn cada Ã©poca. La concepciÃ³n contemporÃ¡nea se apoya esencialmente en vÃ­nculos
conyugales o de parentesco, sin que la mera convivencia sea suficiente para atribuir la
condiciÃ³n de familia.
La idea de familia puede modificarse rÃ¡pidamente por cambios normativos, como demuestra la
equiparaciÃ³n constitucional entre hijos matrimoniales y extramatrimoniales (art. 39.2 CE), que
obligÃ³ a la reforma del sistema de filiaciÃ³n del CÃ³digo Civil en 1981.
Por ello, no existe una definiciÃ³n jurÃ­dica general de familia en la ConstituciÃ³n ni en la
legislaciÃ³n ordinaria, siendo vÃ¡lidas mÃºltiples realidades familiares, salvo a efectos de normas
concretas. Las distinciones entre distintos tipos de familia pertenecen al Ã¡mbito sociolÃ³gico, ya
que el Derecho carece de pautas generales al respecto.
2. EL DERECHO DE FAMILIA
Al Derecho le interesa la familia por razones de organizaciÃ³n social y de tutela de las personas
necesitadas de protecciÃ³n, especialmente menores de edad y personas con discapacidad,
cuya atenciÃ³n ha de procurarse mediante mecanismos sustitutivos cuando la familia no existe o
no resulta suficiente. La solidaridad y el socorro mutuo entre los cÃ³nyuges y los miembros de la
familia resuelven de hecho no pocas tensiones sociales, permitiendo que la estructura polÃ­tica y
administrativa pueda desentenderse de ellas.
La convivencia familiar puede originar numerosos conflictos que requieren una regla de
mediaciÃ³n jurÃ­dica, a los que el Estado no puede permanecer ajeno. El Derecho de familia es el
conjunto de reglas de intermediaciÃ³n y organizaciÃ³n familiar de carÃ¡cter estructural y
comprende la regulaciÃ³n del matrimonio y sus situaciones de crisis, las relaciones entre
padres o progenitores e hijos y las instituciones tutelares en funciÃ³n sustitutiva de la patria
potestad.
3. MODERNAS ORIENTACIONES DEL DERECHO DE FAMILIA
El Derecho de familia es el sector del Derecho civil que ha sido objeto de reformas mÃ¡s
profundas en tiempos contemporÃ¡neos, siendo notoria la abundancia de innovaciones
legislativas producidas en los Ãºltimos aÃ±os y el sentido bÃ¡sico de dichas reformas. Este
fenÃ³meno resulta especialmente visible en EspaÃ±a como consecuencia de dos factores
tÃ©cnicos fundamentales.
Por un lado, la conservaciÃ³n prolongada de la redacciÃ³n originaria del CÃ³digo Civil de 1889,
inspirado en criterios propios del momento codificador, caracterizados por el carÃ¡cter patriarcal
de la familia, la sumisiÃ³n de la mujer a la autoridad del marido y la discriminaciÃ³n radical
entre hijos legÃ­timos e ilegÃ­timos. Por otro lado, la aprobaciÃ³n de la ConstituciÃ³n de 1978,
que, partiendo de conquistas sociolÃ³gicas ya asumidas, consagra principios relativos a la
dinÃ¡mica familiar absolutamente contradictorios con los inspiradores de los CÃ³digos
decimonÃ³nicos.
3.1. Principios constitucionales en relaciÃ³n con el derecho de familia.
La ConstituciÃ³n establece como principios bÃ¡sicos en materia de familia la absoluta
igualdadentre hombre y mujer respecto del matrimonio (art. 32.1). Al proclamar la
aconfesionalidad del Estado (art. 16.3), presupone la recuperaciÃ³n del poder civil en la
regulaciÃ³n del matrimonio, delegando en el legislador ordinario la posibilidad de existencia
del divorcio.
Asimismo, la ConstituciÃ³n consagra la absoluta igualdad ante la ley de los hijos matrimoniales
y extramatrimoniales, asÃ­ como los deberes de los padres en ambos casos (art. 39.2 y 3). A
efectos de la determinaciÃ³n de la filiaciÃ³n, ordena al legislador ordinario la regulaciÃ³n de la
investigaciÃ³n de la paternidad (art. 39.2, Ãºltimo inciso).
3.2. La legislaciÃ³n reformadora del CÃ³digo civil
Los principios constitucionales en materia de familia se han plasmado fundamentalmente
mediante las reformas del CÃ³digo Civil operadas en 1981 por dos leyes de especial relevancia.
La Ley 11/1981, de 13 de mayo, modificÃ³ el CÃ³digo Civil en materia de filiaciÃ³n, patria
potestad y rÃ©gimen econÃ³mico del matrimonio, y la Ley 30/1981, de 7 de julio, reformÃ³ la
regulaciÃ³n del matrimonio y estableciÃ³ el procedimiento en las causas de nulidad, separaciÃ³n
y divorcio. Ambas leyes instauraron el sistema familiar posconstitucional.
Con posterioridad se han dictado otras leyes que han incidido en aspectos concretos del
Derecho de familia, aunque sin alterar el sistema instaurado en 1981, relativas a la tutela, la
adopciÃ³n, la no discriminaciÃ³n por razÃ³n de sexo, la celebraciÃ³n del matrimonio civil, la
protecciÃ³n jurÃ­dica del menor, los nombres y apellidos, la protecciÃ³n patrimonial de las
personas con discapacidad y las relaciones familiares entre nietos y abuelos.
Asumen una significaciÃ³n comparable a la reforma de 1981 las Leyes 13/2005 y 15/2005, la
primera al reconocer el matrimonio entre personas del mismo sexo, y la segunda al reformar
profundamente la crisis matrimonial, suprimiendo el sistema causal y la necesidad de
separaciÃ³n previa al divorcio.
Otras reformas posteriores han afectado a la adopciÃ³n internacional, al Registro Civil, a la
jurisdicciÃ³n voluntaria, a la protecciÃ³n de la infancia y la adolescencia, al apoyo a las
personas con discapacidad en el ejercicio de su capacidad jurÃ­dica, a la filiaciÃ³n en relaciÃ³n
con las personas trans y LGTBI, y a la organizaciÃ³n de la AdministraciÃ³n de Justicia,
destacando la Ley OrgÃ¡nica 1/2025, que introduce los Tribunales de Instancia, exige la
actividad negociadora previa como requisito de procedibilidad en numerosos procesos civiles y
de familia y modifica diversos preceptos del CÃ³digo Civil en materia matrimonial.
3.3. Referencia a la legislaciÃ³n foral o especial
La exposiciÃ³n del Derecho de familia se centra en las disposiciones legislativas de Ã¡mbito
estatal, consideradas como Derecho de familia de aplicaciÃ³n general en EspaÃ±a, sin abordar
de forma sistemÃ¡tica las disposiciones autonÃ³micas vigentes. No obstante, la legislaciÃ³n foral o
especial ha tenido una gran relevancia en materia de rÃ©gimen econÃ³mico del matrimonio,
por lo que se apuntan sus aspectos bÃ¡sicos en las Comunidades AutÃ³nomas de Ã­ndole foral.
Tras la aprobaciÃ³n de la ConstituciÃ³n de 1978 y la instauraciÃ³n del Estado autonÃ³mico, algunas
Comunidades AutÃ³nomas han regulado otros aspectos del Derecho de familia, especialmente en
materia de adopciÃ³n y protecciÃ³n de los menores, mediante diversas leyes autonÃ³micas. En
este contexto, destaca el caso de CataluÃ±a, que ha seguido una polÃ­tica legislativa propia en
materia familiar, integrando su normativa en un CÃ³digo de Familia y posteriormente en un
CÃ³digo Civil propio, cuyo libro segundo se dedica a la persona y la familia.
Pese a estas particularidades, el Derecho de familia ha sido adscrito tradicionalmente en
EspaÃ±a al Derecho civil, considerÃ¡ndose en tÃ©rminos sistemÃ¡ticos Derecho privado, al igual
que las restantes instituciones civiles relativas a la persona, la familia y el patrimonio.
4. NATURALEZA DE LAS NORMAS Y CARACTERES DEL DERECHO DE FAMILIA
4.1. La imperatividad de las normas del Derecho de familia
La mayorÃ­a de las normas del Derecho de familia son imperativas (ius cogens), lo que significa
que prevalecen sobre la voluntad de las personas. La autonomÃ­a privada existe, pero en un
Ã¡mbito muy limitado.
Los miembros de la familia no pueden decidir libremente el contenido jurÃ­dico del matrimonio ni
los deberes hacia los hijos si contradicen la ley. Por tanto, el ordenamiento protege el interÃ©s
familiar y social por encima de acuerdos particulares
4.2. El debate sobre la ubicaciÃ³n sistemÃ¡tica del Derecho de familia
Tradicionalmente se ha destacado el carÃ¡cter imperativo del Derecho de familia frente al
predominio de normas dispositivas en el resto del Derecho civil y privado. Esto ha generado
debates doctrinales sobre si deberÃ­a pertenecer al Derecho civil, al Derecho pÃºblico o a una
categorÃ­a intermedia.
Sin embargo, en EspaÃ±a el Derecho de familia se integra sistemÃ¡ticamente dentro del Derecho
civil, considerÃ¡ndose Derecho privado. Esto se justifica porque el Derecho civil regula las
realidades sociales bÃ¡sicas: persona, familia y patrimonio.
4.3. Los acuerdos familiares
La existencia de normas imperativas en el Derecho de familia no supone la eliminaciÃ³n de la
autonomÃ­a privada de las personas unidas por relaciones familiares. En numerosos supuestos
conflictivos, las propias normas legales presuponen y reclaman acuerdos o convenios entre
los interesados, especialmente entre cÃ³nyuges, tanto en la vida familiar ordinaria como en
situaciones de separaciÃ³n o divorcio, incluidas las relativas al domicilio familiar y a las
pensiones.
La autonomÃ­a privada ha desempeÃ±ado un papel particularmente relevante en las relaciones
patrimoniales entre los cÃ³nyuges, pues el principio bÃ¡sico en materia de rÃ©gimen econÃ³mico
del matrimonio es la libertad de elecciÃ³n del sistema aplicable o incluso la elaboraciÃ³n del
rÃ©gimen que consideren oportuno. En las Ãºltimas dÃ©cadas, esta capacidad de autorregulaciÃ³n
ha adquirido mayor relevancia, especialmente tras las reformas de 1981, hasta el punto de que
no resulta adecuado explicar el sistema afirmando que la imperatividad es la regla y la autonomÃ­a
privada la excepciÃ³n.
Algunos autores han propuesto agrupar estos supuestos bajo la categorÃ­a del negocio jurÃ­dico
de Derecho de familia, pero dicha construcciÃ³n conceptual es considerada dudosa, al no
facilitar la explicaciÃ³n de las instituciones familiares ni proporcionar un rÃ©gimen normativo
general, ademÃ¡s de alterar el esquema general del negocio jurÃ­dico, incluso en relaciÃ³n con el
matrimonio.
4.4. El sentido Ã©tico del derecho de familia
El Derecho de familia, aun siendo imperativo, no puede pretender regular los aspectos mÃ¡s
Ã­ntimos y entraÃ±ables de las relaciones familiares, ni intervenir de forma constante en la vida
cotidiana de la familia. Tampoco pueden los miembros de la familia exigir que todas sus
desavenencias encuentren siempre una respuesta jurÃ­dica directa o una intervenciÃ³n
continuada del juez.
La profundidad y cotidianeidad de las relaciones familiares dificultan concebir el Derecho de
familia como un sistema de reglas mecÃ¡nicas, pues tanto su configuraciÃ³n normativa como su
aplicaciÃ³n prÃ¡ctica presuponen una concordia familiar y la aceptaciÃ³n comÃºn de principios
morales o Ã©ticos, lo que permite destacar el contenido Ã©tico del Derecho de familia.
Este carÃ¡cter Ã©tico se manifiesta, en primer lugar, en la especial influencia de los principios
morales y de las convenciones sociales en este sector del ordenamiento, especialmente en la
regulaciÃ³n del matrimonio y de las relaciones entre padres e hijos, lo que exige al legislador
cautela y prudencia. En segundo lugar, implica que la regulaciÃ³n jurÃ­dica de la familia y las
pautas de conducta habitualmente seguidas por los grupos familiares suelen ser coincidentes.
Aunque la mayor parte de las vivencias familiares se desarrollan sin necesidad de acudir al
Derecho, ello no convierte al Derecho de familia en superfluo, pues el ordenamiento debe ofrecer
vÃ­as de soluciÃ³n para los supuestos de crisis familiar, momento en el que el Derecho de familia
adquiere su verdadera relevancia y significaciÃ³n.
5. LOS DERECHOS SUBJETIVOS FAMILIARES: EL CONCEPTO DE POTESTAD
Los llamados derechos de familia, entendidos como derechos subjetivos propios del Derecho
de familia, se caracterizan tradicionalmente por ser indisponibles, intransmisibles,
irrenunciables e imprescriptibles. Su especial naturaleza impide que su ejercicio quede
sometido a condiciÃ³n o tÃ©rmino, que puedan ejercitarse mediante representante, o que opere
la representaciÃ³n en las relaciones entre cÃ³nyuges o entre padres e hijos, tratÃ¡ndose de
derechos especialmente personalÃ­simos, derivados directamente de los lazos familiares.
No obstante, debe revisarse si los poderes o facultades que las normas atribuyen a algunos
familiares respecto de otros pueden calificarse tÃ©cnicamente como derechos subjetivos o si, por
el contrario, deben entenderse como potestades. Cuando tales poderes no atienden al interÃ©s
particular de quien los ejerce, sino que implican el cuidado, la vigilancia o la consideraciÃ³n de
los intereses de otra u otras personas, resulta mÃ¡s preciso hablar de potestad, siendo el
Derecho de familia el Ã¡mbito propio de esta categorÃ­a en el Derecho privado.
6. FAMILIA, GRUPOS FAMILIARES Y MEDIACIÃ“N FAMILIAR
La pluralidad de las formas de los grupos familiares y la complejidad de las relaciones
actuales han provocado que determinadas situaciones fÃ¡cticas hayan alcanzado en los Ãºltimos
aÃ±os una cierta consagraciÃ³n normativa o, al menos, una necesidad de comprensiÃ³n y apoyo
por los poderes pÃºblicos. Esta realidad exige que, junto a las normas tradicionales de
regulaciÃ³n de los problemas familiares, se recurra al auxilio de otros instrumentos.
En este contexto, destaca la regulaciÃ³n proyectada en el Proyecto de Ley de Familias, orientada
a garantizar los derechos y la igualdad jurÃ­dica en las distintas situaciones familiares,
otorgando protecciÃ³n a todas ellas con pleno respeto a la diversidad familiar.
6.1. LegislaciÃ³n autonÃ³mica sobre mediaciÃ³n
Al amparo del tÃ­tulo competencial de la protecciÃ³n social de la familia, la primera dÃ©cada
del siglo XXI se ha caracterizado por una intensa actividad normativa de las Comunidades
AutÃ³nomas orientada a regular la mediaciÃ³n familiar en sus respectivos territorios. Se parte de
la idea de que las tÃ©cnicas de mediaciÃ³n pueden contribuir a la soluciÃ³n de diversos conflictos
surgidos en el seno de los grupos familiares.
En este marco, numerosas Comunidades AutÃ³nomas han aprobado leyes especÃ­ficas de
mediaciÃ³n familiar, desarrolladas por sus correspondientes reglamentos y disposiciones
complementarias. No obstante, en el momento de cierre de la obra, algunos territorios carecen
de ley especÃ­fica, sin que ello implique la inexistencia de servicios o centros especializados en
mediaciÃ³n familiar.
6.2. La ampliaciÃ³n del Ã¡mbito objetivo: la mediaciÃ³n en asuntos civiles y mercantiles (ley
5/12)
Fue aprobada la Ley 5/2012, de 6 de julio, de mediaciÃ³n en asuntos civiles y mercantiles,
desarrollada parcialmente por el Real Decreto 980/2013, que regula la formaciÃ³n de los
mediadores, crea el Registro de Mediadores, establece la obligaciÃ³n de aseguramiento de su
responsabilidad civil y fija las bases del procedimiento simplificado de mediaciÃ³n por medios
electrÃ³nicos.
La Ley define la mediaciÃ³n como un medio adecuado de soluciÃ³n de controversias en el que
dos o mÃ¡s partes intentan voluntariamente alcanzar un acuerdo mediante un procedimiento
estructurado con la intervenciÃ³n de un mediador. Su Ã¡mbito de aplicaciÃ³n comprende los
asuntos civiles y mercantiles, incluidos los conflictos transfronterizos, siempre que afecten a
derechos y obligaciones disponibles, quedando excluidas la mediaciÃ³n penal, con las
Administraciones pÃºblicas, la laboral y la de consumo.
La mediaciÃ³n se rige por los principios de voluntariedad, igualdad y equilibrio entre las partes,
imparcialidad y neutralidad del mediador y confidencialidad, asÃ­ como por las reglas de
buena fe, respeto mutuo, colaboraciÃ³n y apoyo al mediador. La Ley establece un estatuto
mÃ­nimo del mediador y regula un procedimiento flexible, en el que alcanzar un acuerdo no es
obligatorio. No obstante, cuando se alcanza, el acuerdo de mediaciÃ³n puede adquirir fuerza
ejecutiva mediante homologaciÃ³n judicial o elevaciÃ³n a escritura pÃºblica.
La Ley 5/2012 es una ley general, no limitada a los conflictos familiares, aunque estos se
encuentren incluidos cuando versen sobre derechos disponibles. Ha sido objeto de diversas
reformas, destacando las introducidas por la Ley OrgÃ¡nica 1/2025, que modifica aspectos
relativos a la confidencialidad, al procedimiento y a la duraciÃ³n de la mediaciÃ³n cuando
constituye requisito de procedibilidad, asÃ­ como al rÃ©gimen de presentaciÃ³n y homologaciÃ³n
del acuerdo de mediaciÃ³n.
`.trim();

    /* =========================================================
       2) IDEAS CLAVE (MANUAL)
    ========================================================= */
    const IDEAS_CLAVE = {

  "1": "La familia es una realidad social previa al Derecho, que el ordenamiento jurÃ­dico no crea sino que regula como instituciÃ³n jurÃ­dica.",
  "2": "El Derecho de familia es el conjunto de normas que organizan jurÃ­dicamente la familia, protegen a sus miembros y regulan matrimonio, filiaciÃ³n y funciones tutelares.",
  "3": "El Derecho de familia ha experimentado profundas reformas contemporÃ¡neas impulsadas por el paso del modelo codificador tradicional a los principios constitucionales.",
  "3.1": "La ConstituciÃ³n establece los principios bÃ¡sicos del Derecho de familia, especialmente la igualdad entre cÃ³nyuges y entre hijos y la intervenciÃ³n civil en la regulaciÃ³n matrimonial.",
  "3.2": "La legislaciÃ³n reformadora del CÃ³digo Civil, especialmente las reformas de 1981 y posteriores, configura el sistema familiar posconstitucional.",
  "3.3": "La legislaciÃ³n foral y autonÃ³mica complementa el Derecho de familia estatal, especialmente en materias como rÃ©gimen econÃ³mico matrimonial, adopciÃ³n y protecciÃ³n de menores.",
  "4": "El Derecho de familia se caracteriza por la prevalencia de normas imperativas, la limitaciÃ³n de la autonomÃ­a privada y su fuerte contenido Ã©tico y social.",
  "4.1": "La mayorÃ­a de las normas del Derecho de familia son imperativas (ius cogens), prevaleciendo sobre la voluntad de los particulares.",
  "4.2": "Pese a su fuerte imperatividad, el Derecho de familia se integra sistemÃ¡ticamente en EspaÃ±a dentro del Derecho civil como Derecho privado.",
  "4.3": "La autonomÃ­a privada sigue existiendo en el Derecho de familia, especialmente en acuerdos familiares y en la regulaciÃ³n patrimonial entre cÃ³nyuges.",
  "4.4": "El Derecho de familia posee un marcado contenido Ã©tico, al estar profundamente influido por valores morales y sociales y actuar especialmente en situaciones de crisis familiar.",
  "5": "Los derechos familiares presentan rasgos de indisponibilidad y carÃ¡cter personalÃ­simo, siendo mÃ¡s preciso hablar de potestades cuando se ejercen en interÃ©s de otro miembro de la familia.",
  "6": "La diversidad actual de formas familiares exige nuevas respuestas jurÃ­dicas y mecanismos complementarios como la mediaciÃ³n familiar.",
  "6.1": "Las Comunidades AutÃ³nomas han desarrollado legislaciÃ³n propia sobre mediaciÃ³n familiar para gestionar conflictos dentro de los grupos familiares.",
  "6.2": "La Ley 5/2012 regula la mediaciÃ³n civil y mercantil como sistema voluntario de resoluciÃ³n de conflictos, aplicable tambiÃ©n a conflictos familiares sobre derechos disponibles."

    };

    /* =========================================================
       3) BANCO DE PREGUNTAS (TU BANCO ORIGINAL)
       âœ… OJO: aquÃ­ pegamos TAL CUAL tu banco (1â€“100)
    ========================================================= */
    const BANCO_1 = `#ID=1

// [1]
Q: Â¿QuÃ© implica jurÃ­dicamente que la familia sea considerada una realidad prenormativa anterior al Derecho?
A) Que la familia solo adquiere relevancia jurÃ­dica cuando es definida normativamente por el legislador.
B) Que la familia constituye una realidad social previa cuya regulaciÃ³n jurÃ­dica depende del ordenamiento.
C) Que la familia existe jurÃ­dicamente Ãºnicamente cuando produce efectos patrimoniales.
OK: B
EXP: La familia existe socialmente antes del Derecho, que solo la regula jurÃ­dicamente.

// [2]
Q: Â¿QuÃ© significa que el Derecho de familia no cree la familia, sino que la convierta en instituciÃ³n jurÃ­dica?
A) Que el Derecho determina los modelos familiares legÃ­timos mediante regulaciÃ³n constitutiva.
B) Que el Derecho transforma relaciones sociales familiares en relaciones jurÃ­dicas organizadas.
C) Que el Derecho crea la familia mediante actos jurÃ­dicos constitutivos obligatorios.
OK: B
EXP: El Derecho no crea la familia, la juridifica.

// [3]
Q: Â¿Por quÃ© la mera convivencia no suele ser suficiente para atribuir la condiciÃ³n jurÃ­dica de familia?
A) Porque la convivencia carece de relevancia jurÃ­dica en el Ã¡mbito civil.
B) Porque la condiciÃ³n jurÃ­dica de familia suele apoyarse en vÃ­nculos jurÃ­dicos reconocidos legalmente.
C) Porque la convivencia solo produce efectos administrativos y no civiles.
OK: B
EXP: El Derecho exige normalmente matrimonio o parentesco.

// [4]
Q: Â¿QuÃ© efecto jurÃ­dico tuvo la equiparaciÃ³n constitucional entre hijos matrimoniales y extramatrimoniales?
A) SuprimiÃ³ el sistema de filiaciÃ³n tradicional basado en la determinaciÃ³n biolÃ³gica.
B) Impuso la igualdad jurÃ­dica entre filiaciones, obligando a reformar la regulaciÃ³n civil.
C) EliminÃ³ la posibilidad de establecer filiaciÃ³n extramatrimonial.
OK: B
EXP: La igualdad constitucional exigiÃ³ reformar el sistema civil.

// [5]
Q: Â¿QuÃ© relevancia jurÃ­dica tiene la inexistencia de una definiciÃ³n general de familia en la ConstituciÃ³n?
A) Permite la adaptaciÃ³n del concepto jurÃ­dico de familia a realidades sociales diversas segÃºn cada norma.
B) Impide reconocer jurÃ­dicamente modelos familiares distintos del tradicional.
C) Limita la protecciÃ³n jurÃ­dica familiar a los supuestos matrimoniales.
OK: A
EXP: No hay definiciÃ³n cerrada â†’ pluralidad jurÃ­dica posible.


#ID=2

// [6]
Q: Â¿QuÃ© interÃ©s justifica la intervenciÃ³n del Derecho en la organizaciÃ³n familiar desde la tutela de personas vulnerables?
A) La necesidad de garantizar la organizaciÃ³n econÃ³mica del nÃºcleo familiar.
B) La protecciÃ³n jurÃ­dica de personas en situaciÃ³n de especial vulnerabilidad dentro del grupo familiar.
C) La regulaciÃ³n de las relaciones laborales dentro del Ã¡mbito domÃ©stico.
OK: B
EXP: ProtecciÃ³n de menores y personas con discapacidad.

// [7]
Q: Â¿QuÃ© funciÃ³n social cumple la solidaridad familiar respecto del Estado?
A) Sustituye estructuralmente las funciones asistenciales del Estado.
B) Contribuye a absorber tensiones sociales mediante mecanismos internos de ayuda familiar.
C) Limita la intervenciÃ³n pÃºblica en polÃ­ticas sociales generales.
OK: B
EXP: La familia absorbe funciones sociales.

// [8]
Q: Â¿Por quÃ© los conflictos derivados de la convivencia familiar requieren mediaciÃ³n jurÃ­dica estatal?
A) Porque la convivencia familiar implica siempre relaciones contractuales.
B) Porque los conflictos familiares pueden afectar a derechos que requieren tutela jurÃ­dica.
C) Porque el Estado asume la direcciÃ³n organizativa de la familia.
OK: B
EXP: Requieren regulaciÃ³n jurÃ­dica.

// [9]
Q: Â¿QuÃ© materias integran el contenido estructural del Derecho de familia?
A) La regulaciÃ³n del matrimonio, la filiaciÃ³n y las instituciones de protecciÃ³n familiar.
B) Exclusivamente la regulaciÃ³n econÃ³mica del matrimonio.
C) Solo las relaciones patrimoniales entre familiares.
OK: A
EXP: Son los pilares del Derecho de familia.


#ID=3

// [10]
Q: Â¿Por quÃ© el Derecho de familia ha experimentado reformas especialmente profundas en la Ã©poca contemporÃ¡nea?
A) La necesidad de adaptar el sistema jurÃ­dico familiar a transformaciones sociales y constitucionales.
B) La sustituciÃ³n del Derecho civil por el Derecho pÃºblico en materia familiar.
C) La desapariciÃ³n del modelo matrimonial como base jurÃ­dica familiar.
OK: A
EXP: Cambios sociales + ConstituciÃ³n.

// [11]
Q: Â¿QuÃ© contradicciÃ³n existÃ­a entre el modelo del CÃ³digo Civil de 1889 y los principios de la ConstituciÃ³n de 1978?
A) El CÃ³digo Civil establecÃ­a igualdad jurÃ­dica plena entre todos los miembros de la familia.
B) El modelo del CÃ³digo Civil respondÃ­a a esquemas patriarcales incompatibles con la ConstituciÃ³n.
C) El CÃ³digo Civil impedÃ­a la regulaciÃ³n legal del divorcio.
OK: B
EXP: Modelo patriarcal vs igualdad constitucional.

// [12]
Q: Â¿QuÃ© factores explican la necesidad de reformar el Derecho de familia en la etapa constitucional?
A) La evoluciÃ³n social junto a la incorporaciÃ³n de principios constitucionales igualitarios.
B) La unificaciÃ³n del Derecho civil europeo.
C) La sustituciÃ³n del Derecho civil por legislaciÃ³n autonÃ³mica.
OK: A
EXP: Reforma social + constitucional.

// [13]
Q: Â¿QuÃ© transformaciÃ³n conceptual introduce la ConstituciÃ³n en la concepciÃ³n jurÃ­dica de la familia?
A) Introduce un modelo jurÃ­dico familiar basado en igualdad, pluralidad y protecciÃ³n constitucional.
B) Establece un modelo Ãºnico de familia jurÃ­dicamente protegido.
C) Reduce la intervenciÃ³n del Derecho en las relaciones familiares.
OK: A
EXP: Igualdad + pluralidad + protecciÃ³n.


#ID=3.1

// [14]
Q: Â¿QuÃ© consecuencias tuvo la igualdad constitucional entre hombre y mujer respecto del matrimonio?
A) Impuso la revisiÃ³n del sistema jurÃ­dico matrimonial para eliminar desigualdades entre cÃ³nyuges.
B) EliminÃ³ la regulaciÃ³n civil del matrimonio.
C) SuprimiÃ³ el rÃ©gimen econÃ³mico matrimonial legal.
OK: A
EXP: EliminaciÃ³n desigualdades.

// [15]
Q: Â¿QuÃ© efecto jurÃ­dico deriva de la aconfesionalidad del Estado en relaciÃ³n con el matrimonio?
A) Refuerza la competencia civil del Estado sobre el matrimonio y permite su regulaciÃ³n legal completa.
B) ProhÃ­be el matrimonio religioso con efectos civiles.
C) Impone un modelo matrimonial Ãºnico obligatorio.
OK: A
EXP: RegulaciÃ³n civil + divorcio.

// [16]
Q: Â¿QuÃ© mandato impone la ConstituciÃ³n al legislador respecto de la investigaciÃ³n de la paternidad?
A) Obliga al legislador a establecer mecanismos legales de investigaciÃ³n de la paternidad.
B) Limita la investigaciÃ³n de la paternidad a procesos penales.
C) Subordina la investigaciÃ³n a la voluntad paterna.
OK: A
EXP: Mandato constitucional.

// [17]
Q: Â¿QuÃ© alcance tiene la igualdad constitucional entre hijos matrimoniales y extramatrimoniales?
A) Garantiza igualdad jurÃ­dica plena entre todos los hijos con independencia de su filiaciÃ³n.
B) Permite diferencias patrimoniales entre hijos matrimoniales y extramatrimoniales.
C) Limita derechos sucesorios a la filiaciÃ³n matrimonial.
OK: A
EXP: Igualdad total.


#ID=3.2

// [18]
Q: Â¿QuÃ© transformaciÃ³n del sistema familiar introdujeron las reformas del CÃ³digo Civil de 1981?
A) Adaptaron el sistema familiar a los principios constitucionales de igualdad y no discriminaciÃ³n.
B) Sustituyeron el Derecho civil por normativa administrativa.
C) Eliminan la regulaciÃ³n civil del matrimonio.
OK: A
EXP: AdaptaciÃ³n constitucional.

// [19]
Q: Â¿Por quÃ© se considera que las reformas de 1981 instauraron el sistema familiar posconstitucional?
A) Incorporaron de forma sistemÃ¡tica los principios constitucionales al Derecho civil familiar.
B) Derogaron el CÃ³digo Civil en materia familiar.
C) Sustituyeron el matrimonio por uniones civiles obligatorias.
OK: A
EXP: IntegraciÃ³n constitucional.

// [20]
Q: Â¿QuÃ© finalidad general han tenido las reformas posteriores del Derecho de familia tras 1981?
A) Desarrollar y actualizar el sistema familiar sin alterar su estructura posconstitucional bÃ¡sica.
B) Sustituir completamente el modelo familiar civil.
C) Eliminar la regulaciÃ³n jurÃ­dica del matrimonio.
OK: A
EXP: EvoluciÃ³n sin ruptura estructural.
`;
    const BANCO_2 = `#ID=3.3

// [21]
Q: Â¿QuÃ© relevancia tiene la legislaciÃ³n foral o especial en materia de rÃ©gimen econÃ³mico del matrimonio?
A) Ha tenido una incidencia relevante, especialmente en la configuraciÃ³n del rÃ©gimen econÃ³mico matrimonial en territorios con Derecho civil propio.
B) Solo ha afectado a materias sucesorias sin incidencia en la regulaciÃ³n matrimonial.
C) Ha sustituido completamente la regulaciÃ³n estatal del rÃ©gimen econÃ³mico matrimonial.
OK: A
EXP: Especialmente relevante en rÃ©gimen econÃ³mico matrimonial.

// [22]
Q: Â¿Por quÃ© el estudio del Derecho de familia suele centrarse en la legislaciÃ³n estatal pese a la existencia de normas autonÃ³micas?
A) Porque la legislaciÃ³n estatal actÃºa como Derecho comÃºn general aplicable a todo el territorio nacional.
B) Porque las Comunidades AutÃ³nomas carecen de competencia normativa en Derecho civil.
C) Porque la legislaciÃ³n autonÃ³mica tiene carÃ¡cter meramente interpretativo.
OK: A
EXP: El Derecho estatal funciona como base comÃºn.

// [23]
Q: Â¿QuÃ© particularidad presenta la regulaciÃ³n del Derecho de familia en CataluÃ±a respecto del resto de Comunidades AutÃ³nomas?
A) Ha desarrollado un sistema normativo propio integrado en su propio CÃ³digo Civil con regulaciÃ³n sistemÃ¡tica de la familia.
B) Ha limitado su normativa familiar exclusivamente al Ã¡mbito patrimonial del matrimonio.
C) Ha renunciado a la regulaciÃ³n propia del Derecho de familia en favor del Derecho estatal.
OK: A
EXP: CataluÃ±a tiene CÃ³digo Civil propio con regulaciÃ³n familiar integrada.


#ID=4

// [24]
Q: Â¿Por quÃ© el Derecho de familia se caracteriza por una fuerte presencia de normas imperativas?
A) Porque predomina la existencia de normas imperativas destinadas a proteger intereses familiares y sociales.
B) Porque el Derecho de familia carece de autonomÃ­a frente al Derecho pÃºblico.
C) Porque las relaciones familiares son exclusivamente patrimoniales.
OK: A
EXP: Predomina el ius cogens por protecciÃ³n de intereses superiores.

// [25]
Q: Â¿QuÃ© implica la prevalencia del ius cogens sobre la autonomÃ­a privada en el Ã¡mbito familiar?
A) Que la autonomÃ­a privada queda subordinada a lÃ­mites legales establecidos para proteger intereses familiares.
B) Que la autonomÃ­a privada desaparece completamente en el Ã¡mbito familiar.
C) Que la autonomÃ­a privada prevalece siempre sobre la norma legal en materia familiar.
OK: A
EXP: Existe autonomÃ­a, pero dentro de lÃ­mites legales.


#ID=4.2

// [26]
Q: Â¿Por quÃ© el Derecho de familia se integra dentro del Derecho civil pese a su carÃ¡cter imperativo?
A) Porque regula relaciones jurÃ­dicas entre particulares, aunque con fuerte intervenciÃ³n normativa.
B) Porque depende jerÃ¡rquicamente del Derecho administrativo.
C) Porque carece de normas imperativas.
OK: A
EXP: Regula relaciones privadas con fuerte intervenciÃ³n normativa.

// [27]
Q: Â¿QuÃ© argumentos doctrinales han cuestionado su adscripciÃ³n al Derecho privado?
A) Que la fuerte presencia de normas imperativas lo aproxima funcionalmente al Derecho pÃºblico.
B) Que el Derecho de familia regula exclusivamente relaciones econÃ³micas.
C) Que el Derecho de familia depende del Derecho penal.
OK: A
EXP: Imperatividad intensa â†’ debate doctrinal.


#ID=4.3

// [28]
Q: Â¿QuÃ© papel desempeÃ±a la autonomÃ­a privada en los acuerdos familiares actuales?
A) Permite la autorregulaciÃ³n familiar dentro de los lÃ­mites establecidos por el ordenamiento jurÃ­dico.
B) Permite sustituir completamente la regulaciÃ³n legal imperativa.
C) Solo tiene efectos simbÃ³licos sin valor jurÃ­dico.
OK: A
EXP: Existe autorregulaciÃ³n dentro de lÃ­mites legales.

// [29]
Q: Â¿Por quÃ© ha aumentado la relevancia de la autorregulaciÃ³n familiar en las Ãºltimas dÃ©cadas?
A) Por la evoluciÃ³n social y las reformas legales que han reforzado la capacidad de autorregulaciÃ³n patrimonial familiar.
B) Por la desapariciÃ³n de las normas imperativas familiares.
C) Por la sustituciÃ³n del Derecho civil por acuerdos privados.
OK: A
EXP: Reformas modernas â†’ mÃ¡s espacio autonomÃ­a privada.

// [30]
Q: Â¿QuÃ© lÃ­mites presenta la categorÃ­a del negocio jurÃ­dico de Derecho de familia?
A) No ofrece un rÃ©gimen normativo general ni explica de forma completa las instituciones familiares.
B) Sustituye completamente la teorÃ­a general del negocio jurÃ­dico.
C) Solo es aplicable a relaciones patrimoniales matrimoniales.
OK: A
EXP: CategorÃ­a doctrinal discutida y limitada.


#ID=4.4

// [31]
Q: Â¿Por quÃ© el Derecho de familia no puede concebirse como un sistema de reglas mecÃ¡nicas?
A) Porque las relaciones familiares estÃ¡n influidas por factores morales, sociales y afectivos que dificultan una aplicaciÃ³n automÃ¡tica de normas.
B) Porque el Derecho de familia carece de normas jurÃ­dicas obligatorias.
C) Porque depende exclusivamente de decisiones judiciales discrecionales.
OK: A
EXP: Influencia Ã©tica y social.

// [32]
Q: Â¿QuÃ© funciÃ³n cumple el contenido Ã©tico del Derecho de familia?
A) Orienta la interpretaciÃ³n y aplicaciÃ³n de las normas familiares conforme a valores sociales y morales.
B) Sustituye completamente la funciÃ³n normativa del Derecho.
C) Limita la intervenciÃ³n del legislador en materia familiar.
OK: A
EXP: FunciÃ³n interpretativa y orientadora.


#ID=5

// [33]
Q: Â¿QuÃ© caracterÃ­sticas tradicionales definen a los derechos subjetivos familiares?
A) Indisponibilidad, intransmisibilidad, irrenunciabilidad e imprescriptibilidad.
B) Libre transmisiÃ³n, disponibilidad plena y prescripciÃ³n ordinaria.
C) Naturaleza exclusivamente patrimonial.
OK: A
EXP: Derechos personalÃ­simos.

// [34]
Q: Â¿QuÃ© consecuencias jurÃ­dicas se derivan del carÃ¡cter personalÃ­simo de los derechos familiares?
A) Impide normalmente su ejercicio mediante representaciÃ³n por su carÃ¡cter personalÃ­simo.
B) Permite su libre transmisiÃ³n entre familiares.
C) Permite su ejercicio condicionado a plazo.
OK: A
EXP: No suelen ser ejercitables por representaciÃ³n.

// [35]
Q: Â¿Por quÃ© en algunos casos es mÃ¡s correcto hablar de potestades que de derechos subjetivos?
A) Porque determinados poderes familiares se ejercen en interÃ©s de otra persona y no en interÃ©s propio.
B) Porque son derechos patrimoniales transmisibles.
C) Porque son facultades discrecionales sin lÃ­mites jurÃ­dicos.
OK: A
EXP: La clave es el interÃ©s protegido.


#ID=6

// [36]
Q: Â¿QuÃ© justifica la necesidad de recurrir a instrumentos distintos de las normas tradicionales en los conflictos familiares actuales?
A) La complejidad y pluralidad actual de las relaciones familiares exige mecanismos complementarios de resoluciÃ³n de conflictos.
B) La desapariciÃ³n del Derecho civil como sistema regulador.
C) La sustituciÃ³n del sistema judicial por mecanismos privados obligatorios.
OK: A
EXP: Complejidad social â†’ nuevos instrumentos.

// [37]
Q: Â¿QuÃ© finalidad persigue el Proyecto de Ley de Familias respecto de la diversidad familiar?
A) Garantizar la igualdad jurÃ­dica y la protecciÃ³n de la diversidad de modelos familiares.
B) Limitar la protecciÃ³n jurÃ­dica a la familia matrimonial tradicional.
C) Sustituir la regulaciÃ³n civil por regulaciÃ³n administrativa.
OK: A
EXP: ProtecciÃ³n pluralidad familiar.


#ID=6.1

// [38]
Q: Â¿QuÃ© tÃ­tulo competencial ha permitido a las Comunidades AutÃ³nomas legislar sobre mediaciÃ³n familiar?
A) La competencia en materia de protecciÃ³n social de la familia.
B) La competencia exclusiva estatal en Derecho penal.
C) La competencia autonÃ³mica en polÃ­tica monetaria.
OK: A
EXP: ProtecciÃ³n social familiar â†’ base competencial.


#ID=6.2

// [39]
Q: Â¿QuÃ© condiciÃ³n delimita el Ã¡mbito de aplicaciÃ³n de la mediaciÃ³n segÃºn la Ley 5/2012?
A) Que el conflicto afecte a derechos y obligaciones disponibles por las partes.
B) Que exista necesariamente intervenciÃ³n judicial previa.
C) Que el conflicto tenga naturaleza penal.
OK: A
EXP: Solo derechos disponibles.

// [40]
Q: Â¿QuÃ© efecto jurÃ­dico puede adquirir el acuerdo alcanzado en mediaciÃ³n conforme a la Ley 5/2012?
A) Puede adquirir fuerza ejecutiva mediante homologaciÃ³n judicial o elevaciÃ³n a escritura pÃºblica.
B) Solo tiene valor moral entre las partes.
C) Solo produce efectos administrativos.
OK: A
EXP: Puede convertirse en tÃ­tulo ejecutivo.
`;
    const BANCO_3 = `...Pega aquÃ­ tu BANCO_3 completo...`;
    const BANCO_4 = `...Pega aquÃ­ tu BANCO_4 completo...`;
    const BANCO_5 = `...Pega aquÃ­ tu BANCO_5 completo...`;

    const BANCO_TEXTO = [BANCO_1, BANCO_2, BANCO_3, BANCO_4, BANCO_5]
      .map(s => String(s || "").trim())
      .filter(Boolean)
      .join("\n\n");

    /* =========================
       HELPERS
    ========================= */
    function escapeHtml(s){
      return String(s ?? "")
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
    }
    
    function quitarTituloRepetidoSeguro(texto, titulo){
  const t0 = String(texto || "");
  const h0 = String(titulo || "");
  if(!t0.trim() || !h0.trim()) return t0.trim();

  // Normaliza: minÃºsculas + espacios raros (NBSP) + BOM
  const clean = s => String(s)
    .replace(/^\uFEFF/, "")          // BOM
    .replace(/\u00A0/g, " ")         // NBSP -> espacio normal
    .replace(/\s+/g, " ")
    .trim()
    .toLowerCase();

  const t = clean(t0);
  const h = clean(h0);

  if(!t.startsWith(h)) return t0.trim();

  // Corta del texto ORIGINAL, pero usando la longitud del tÃ­tulo ORIGINAL
  // (buscamos el match real al principio ignorando mayÃºsculas y espacios raros)
  const re = new RegExp(
    "^\\s*" + h0.trim()
      .replace(/[.*+?^${}()|[\]\\]/g, "\\$&")   // escape regex
      .replace(/\s+/g, "[\\s\\u00A0]+")         // admite NBSP
    + "[\\s\\u00A0]+",
    "i"
  );

  return t0.replace(re, "").trim();
}




function formatearParrafos(t){
  const lines = String(t ?? "").replace(/\r/g,"").split("\n");

  const isBullet = (s) => /^\s*(â€¢|â€“|-)\s+/.test(s);
  const isEpig   = (s) => /^\s*\d+(?:\.\d+)*\.\s+/.test(s);     // 1. / 1.1. / 1.1.1.
  const isEnum   = (s) => /^\s*\d+\s*-\s+/.test(s);             // 1- ...
  const newBlock = (s) => isBullet(s) || isEpig(s) || isEnum(s);

  const paras = [];
  let cur = "";

  for(let i=0;i<lines.length;i++){
    const raw = lines[i];
    const line = raw.trim();

    // âœ… lÃ­nea vacÃ­a = FIN de pÃ¡rrafo (esto es lo que te faltaba)
    if(!line){
      if(cur) paras.push(cur.trim());
      cur = "";
      continue;
    }

    // âœ… listas/epÃ­grafes/enumeraciones: cada uno en su propio pÃ¡rrafo
    if(newBlock(line)){
      if(cur) paras.push(cur.trim());
      paras.push(line);
      cur = "";
      continue;
    }

    // empieza pÃ¡rrafo
    if(!cur){
      cur = line;
      continue;
    }

    // âœ… une cortes tÃ­picos de PDF (sin cargarte pÃ¡rrafos)
    const prevEndsSentence = /[.!?:]$/.test(cur.trim());
    const nextStartsLower  = /^[a-zÃ¡Ã©Ã­Ã³ÃºÃ±]/.test(line);

    if(!prevEndsSentence && nextStartsLower){
      cur += " " + line;
    }else{
      paras.push(cur.trim());
      cur = line;
    }
  }

  if(cur) paras.push(cur.trim());

  return paras.map(p => `<p>${escapeHtml(p)}</p>`).join("");
}
    function normalizeKey(s){
      return String(s || "")
        .trim()
        .toLowerCase()
        .replace(/\s+/g," ")
        .slice(0,220);
    }

    // JerarquÃ­a epÃ­grafes
    function esDescendiente(idHijo, idPadre){
      return String(idHijo).startsWith(String(idPadre) + ".");
    }
    function parentId(id){
      const parts = String(id || "").split(".");
      if(parts.length <= 1) return null;
      parts.pop();
      return parts.join(".");
    }

    /* =========================
       PDF -> epÃ­grafes
    ========================= */
    function extraerEncabezados(){
      // Soporta: "1. TÃTULO" y "1.1. TÃTULO"
      const re = /^\s*(\d+(?:\.\d+)*)\.\s+(.+?)\s*$/;
      const lines = String(PDF_TEXTO).replace(/\r/g,"").split("\n");
      const out = [];
      for(const l of lines){
        const m = l.match(re);
        if(!m) continue;
        out.push({ id:m[1], titulo:`${m[1]}. ${m[2].trim()}` });
      }
      return out;
    }

    function textoPorId(id){
      if(!id) return "";
      const safe = id.replace(/\./g,"\\.");
      const reStart = new RegExp(`(^|\\n)${safe}\\.\\s+`, "m");
      const full = String(PDF_TEXTO);
      const m = full.match(reStart);
      if(!m) return "";
      const startIdx = full.indexOf(m[0]) + m[0].length;
      const rest = full.slice(startIdx);
      const nextIdx = rest.search(/\n\s*\d+(?:\.\d+)*\.\s+/);
      const chunk = (nextIdx === -1 ? rest : rest.slice(0, nextIdx)).trim();
      return chunk;
    }

    /* =========================
       PARSER banco
    ========================= */
    function parseBanco(texto){
      const t = String(texto || "").replace(/\r/g, "");
      const bloques = t.split(/\n(?=#ID\s*=\s*)/g).map(x=>x.trim()).filter(Boolean);
      const QUIZ = {};
      for(const bloque of bloques){
        const mId = bloque.match(/^#ID\s*=\s*([0-9]+(?:\.[0-9]+)*)\s*$/m);
        if(!mId) continue;
        const id = mId[1];

        const sinHeader = bloque.replace(/^#ID\s*=\s*[0-9]+(?:\.[0-9]+)*\s*$/m, "").trim();
        const partesQ = sinHeader.split(/\n(?=Q:\s*)/g).map(x=>x.trim()).filter(Boolean);

        const preguntas = [];
        for(const pq of partesQ){
          // âœ… acepta: // [1]  o  // N: 1
          const nMatch = pq.match(/^\/\/\s*(?:N:|\[)\s*([0-9]{1,3})\s*\]?\s*$/m);
          const qMatch = pq.match(/^Q:\s*(.+)$/m);
          if(!qMatch) continue;

          const aMatch = pq.match(/^A\)\s*(.+)$/m);
          const bMatch = pq.match(/^B\)\s*(.+)$/m);
          const cMatch = pq.match(/^C\)\s*(.+)$/m);
          const okMatch = pq.match(/^OK:\s*([ABC])\s*$/m);
          const expMatch = pq.match(/^EXP:\s*([\s\S]+)$/m);

          if(!aMatch || !bMatch || !cMatch || !okMatch) continue;

          const preguntaTxt = qMatch[1].trim();
          const uid = `${id}::${normalizeKey(preguntaTxt)}`;

          preguntas.push({
            __id: id,
            __uid: uid,
            __n: nMatch ? Number(nMatch[1]) : null,
            pregunta: preguntaTxt,
            a: aMatch[1].trim(),
            b: bMatch[1].trim(),
            c: cMatch[1].trim(),
            correcta: okMatch[1].toLowerCase(),
            explicacion: expMatch ? expMatch[1].trim() : ""
          });
        }

        if(!QUIZ[id]) QUIZ[id] = [];
        QUIZ[id].push(...preguntas);
      }
      return QUIZ;
    }

    const QUIZ = parseBanco(BANCO_TEXTO);

    function buildTemaPool(QUIZ){
      const pool = [];
      for(const id of Object.keys(QUIZ || {})){
        const list = QUIZ[id];
        if(Array.isArray(list)) pool.push(...list);
      }
      return pool;
    }
    let TEMA_POOL = buildTemaPool(QUIZ);

    /* =========================
       STORAGE
    ========================= */
    const STORAGE_KEY = "DA_TEMA2_STATS_V1";
    function loadStore(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return { wrongUids: {}, stats: { ok:0, bad:0, blank:0 } };
        const parsed = JSON.parse(raw);
        return {
          wrongUids: parsed.wrongUids || {},
          stats: parsed.stats || { ok:0, bad:0, blank:0 }
        };
      }catch{
        return { wrongUids: {}, stats: { ok:0, bad:0, blank:0 } };
      }
    }
    function saveStore(){
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(STORE));
      }catch{}
    }
    let STORE = loadStore();

    function markWrong(uid){ STORE.wrongUids[uid] = true; saveStore(); }
    function clearWrong(uid){ delete STORE.wrongUids[uid]; saveStore(); }
    function isWrong(uid){ return !!STORE.wrongUids[uid]; }

    /* =========================
       DOM refs
    ========================= */
    const modalOverlay = document.getElementById("modalOverlay");
    const btnCloseModal = document.getElementById("btnCloseModal");
    const btnNextQuestion = document.getElementById("btnNextQuestion");
    const btnBlank = document.getElementById("btnBlank");

    const modalPill = document.getElementById("modalPill");
    const modalTitle = document.getElementById("modalTitle");
    const modalQuestion = document.getElementById("modalQuestion");
    const modalOptions = document.getElementById("modalOptions");
    const modalFeedback = document.getElementById("modalFeedback");
    const modalFeedbackTitle = document.getElementById("modalFeedbackTitle");
    const modalExplanation = document.getElementById("modalExplanation");
    const modalCounter = document.getElementById("modalCounter");
    const scoreLine = document.getElementById("scoreLine");
    const modalTimer = document.getElementById("modalTimer");

    const btnTemaRandom = document.getElementById("btnTemaRandom");
    const selTemaN = document.getElementById("selTemaN");
    const btnSoloFalladas = document.getElementById("btnSoloFalladas");
    const btnResetStats = document.getElementById("btnResetStats");
    const badgeTemaTotal = document.getElementById("badgeTemaTotal");

    /* =========================
       ESTADO QUIZ
    ========================= */
    let currentMode = "epigrafe";
    let currentId = null;
    let deck = [];
    let idx = 0;
    let currentQ = null;
    let answered = false;

    let ses_ok = 0, ses_bad = 0, ses_blank = 0;

    function computeUNEDGrade(){
      const total = ses_ok + ses_bad + ses_blank;
      const puntos =
        (ses_ok * SCORE_OK) -
        (ses_bad * SCORE_BAD) +
        (ses_blank * SCORE_BLANK);
      return { puntos, total };
    }
    function renderScoreLine(){
      const { puntos, total } = computeUNEDGrade();
      scoreLine.textContent =
        `Aciertos ${ses_ok} Â· Fallos ${ses_bad} Â· Blancos ${ses_blank} Â· Puntos ${puntos.toFixed(2)} (de ${total})`;
    }

    /* =========================
       TIMER
    ========================= */
    let timerStart = 0;
    let timerHandle = null;

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }
    function fmtTime(ms){
      const s = Math.floor(ms/1000);
      const mm = String(Math.floor(s/60)).padStart(2,"0");
      const ss = String(s%60).padStart(2,"0");
      return `${mm}:${ss}`;
    }
    function stopTimer(){
      if(timerHandle){
        clearInterval(timerHandle);
        timerHandle = null;
      }
    }
    function startTimer(){
      stopTimer();
      timerStart = Date.now();
      timerHandle = setInterval(()=>{
        modalTimer.textContent = fmtTime(Date.now() - timerStart);
      }, 250);
    }
    function openModal(){
      modalOverlay.classList.add("show");
      modalOverlay.setAttribute("aria-hidden","false");
      startTimer();
    }
    function closeModal(){
      modalOverlay.classList.remove("show");
      modalOverlay.setAttribute("aria-hidden","true");
      stopTimer();

      currentMode = "epigrafe";
      currentId = null;
      deck = [];
      idx = 0;
      currentQ = null;
      answered = false;

      modalOptions.innerHTML = "";
      modalFeedback.className = "feedback";
      modalFeedback.classList.remove("show");
      modalQuestion.textContent = "â€”";
      modalCounter.textContent = "0/0";
      modalTimer.textContent = "00:00";
    }

    function setFeedback(kind, title, explanation){
      modalFeedback.classList.remove("ok","bad");
      modalFeedback.classList.add(kind);
      modalFeedbackTitle.textContent = title;
      modalExplanation.textContent = explanation ? explanation : "";
      modalFeedback.classList.add("show");
    }

    /* =========================
       DECK BUILDERS
    ========================= */
    function buildDeckForEpigrafe(id){
      const list = Array.isArray(QUIZ[id]) ? QUIZ[id] : [];
      return shuffle(list);
    }
    function buildDeckForTema(n){
      const pool = TEMA_POOL.slice();
      const barajado = shuffle(pool);
      const wanted = Math.max(1, Math.min(Number(n || 20), barajado.length));
      return barajado.slice(0, wanted);
    }
    function buildDeckForFalladas(){
      const pool = TEMA_POOL.filter(q => isWrong(q.__uid));
      return shuffle(pool);
    }

    function getNextFromDeck(){
      if(!deck.length) return null;
      if(idx >= deck.length){
        if(currentMode === "tema") return null;
        deck = shuffle(deck);
        idx = 0;
      }
      const q = deck[idx];
      idx += 1;
      return q;
    }

    /* =========================
       RENDER PREGUNTA
    ========================= */
    function renderQuestion(){
      const q = getNextFromDeck();
      if(!q){
        alert("Fin del test.");
        closeModal();
        return;
      }

      currentQ = q;
      answered = false;
      modalFeedback.className = "feedback";
      modalFeedback.classList.remove("show");

      modalPill.textContent = q.__id || currentId || "â€”";
      modalTitle.textContent =
        currentMode === "tema" ? "Modo tema (aleatorio)" :
        currentMode === "falladas" ? "Solo falladas" :
        "Por epÃ­grafe";

      modalQuestion.textContent = q.pregunta;
      modalCounter.textContent = `${Math.min(idx, deck.length)}/${deck.length}`;

      let opts = [
        { label:"A", text:q.a, isCorrect: q.correcta === "a" },
        { label:"B", text:q.b, isCorrect: q.correcta === "b" },
        { label:"C", text:q.c, isCorrect: q.correcta === "c" },
      ];
      opts = shuffle(opts);

      modalOptions.innerHTML = opts.map(o=>`
        <button class="optBtn" type="button" data-correct="${o.isCorrect ? "1" : "0"}">
          <span class="k">${o.label}</span>${escapeHtml(o.text)}
        </button>
      `).join("");

      [...modalOptions.querySelectorAll(".optBtn")].forEach(btn=>{
        btn.addEventListener("click", ()=>{
          if(answered) return;
          answered = true;

          const chosenCorrect = btn.getAttribute("data-correct") === "1";

          if(chosenCorrect){
            ses_ok += 1;
            clearWrong(q.__uid);
            setFeedback("ok", "Correcto âœ…", q.explicacion);
          }else{
            ses_bad += 1;
            markWrong(q.__uid);
            const correctLabel = (q.correcta || "").toUpperCase();
            setFeedback("bad", `Incorrecto âŒ (Correcta: ${correctLabel})`, q.explicacion);
          }

          renderScoreLine();
          refreshTemaStats();
        });
      });
    }

    /* =========================
       START MODOS
    ========================= */
    function startQuizForId(id){
      const list = Array.isArray(QUIZ[id]) ? QUIZ[id] : [];
      if(!list.length){
        alert(`No hay preguntas cargadas para el epÃ­grafe ${id}.`);
        return;
      }
      currentMode = "epigrafe";
      currentId = id;
      deck = buildDeckForEpigrafe(id);
      idx = 0;
      ses_ok = 0; ses_bad = 0; ses_blank = 0;
      renderScoreLine();
      openModal();
      renderQuestion();
    }

    function startQuizTema(){
      if(!TEMA_POOL.length){
        alert("No hay preguntas cargadas en el tema todavÃ­a.");
        return;
      }
      const n = selTemaN ? Number(selTemaN.value) : 20;
      currentMode = "tema";
      currentId = "TEMA";
      deck = buildDeckForTema(n);
      idx = 0;
      ses_ok = 0; ses_bad = 0; ses_blank = 0;
      renderScoreLine();
      openModal();
      renderQuestion();
    }

    function startQuizFalladas(){
      const d = buildDeckForFalladas();
      if(!d.length){
        alert("No tienes falladas guardadas aÃºn.");
        return;
      }
      currentMode = "falladas";
      currentId = "FALLADAS";
      deck = d;
      idx = 0;
      ses_ok = 0; ses_bad = 0; ses_blank = 0;
      renderScoreLine();
      openModal();
      renderQuestion();
    }

    function blankQuestion(){
      if(answered) return;
      answered = true;
      ses_blank += 1;
      setFeedback("bad", "En blanco âšª", currentQ ? currentQ.explicacion : "");
      renderScoreLine();
      refreshTemaStats();
    }

    function refreshTemaStats(){
      const total = TEMA_POOL.length;
      const wrongCount = Object.keys(STORE.wrongUids || {}).length;
      if(badgeTemaTotal){
        badgeTemaTotal.textContent = `${total} cargadas Â· ${wrongCount} falladas guardadas`;
      }
      if(diag){
        diag.innerHTML = `DiagnÃ³stico: <b>OK</b> Â· EpÃ­grafes detectados: <b>${extraerEncabezados().length}</b> Â· Preguntas cargadas: <b>${TEMA_POOL.length}</b>`;
      }
    }

    /* =========================
       âœ… RENDER ACORDEÃ“N EN CASCADA (ÃRBOL)
    ========================= */
    const cont = document.getElementById("contenido");
    cont.innerHTML = "";

    const heads = extraerEncabezados();

    // Construye nodos
    const nodesById = new Map();
    heads.forEach(h=>{
      nodesById.set(h.id, { ...h, children: [] });
    });

    // Enlaza padre-hijo
    const roots = [];
    heads.forEach(h=>{
      const node = nodesById.get(h.id);
      const pid = parentId(h.id);
      if(pid && nodesById.has(pid)){
        nodesById.get(pid).children.push(node);
      }else{
        roots.push(node);
      }
    });

    // Ordena hijos numÃ©ricamente (1.10 despuÃ©s de 1.2, etc.)
    function cmpIds(a,b){
      const pa = a.id.split(".").map(Number);
      const pb = b.id.split(".").map(Number);
      const len = Math.max(pa.length, pb.length);
      for(let i=0;i<len;i++){
        const xa = pa[i] ?? -1;
        const xb = pb[i] ?? -1;
        if(xa !== xb) return xa - xb;
      }
      return 0;
    }
    function sortTree(list){
      list.sort(cmpIds);
      list.forEach(n=>sortTree(n.children));
    }
    sortTree(roots);

    // Render recursivo
function renderNode(node){
  let txt = textoPorId(node.id);
  const idea = (IDEAS_CLAVE[node.id] ?? "").toString().trim();
  const quizCount = Array.isArray(QUIZ[node.id]) ? QUIZ[node.id].length : 0;

  const titleNoId = node.titulo.replace(
    new RegExp("^" + node.id.replace(/\./g,"\\.") + "\\.\\s*"),
    ""
  );

  // âœ… QUITA el tÃ­tulo repetido al inicio del texto
  txt = quitarTituloRepetidoSeguro(txt, titleNoId);

  const d = document.createElement("details");
  d.open = false;
  d.dataset.id = node.id;

      d.innerHTML = `
        <summary>
          <div class="sumLeft">
            <span class="pill">${escapeHtml(node.id)}</span>
            <span class="sumTitle">${escapeHtml(titleNoId)}</span>
          </div>
          <div class="sumRight" style="display:flex; gap:10px; align-items:center;">
            ${quizCount ? `<span class="badge">${quizCount} preguntas</span>` : `<span class="badge"></span>`}
          </div>
        </summary>

        <div class="inner">
          ${txt ? `<div class="prio"><div class="tag">Texto prioritario</div>${formatearParrafos(txt)}</div>` : ""}
          ${idea ? `<div class="idea"><div class="tag">Idea clave</div>${escapeHtml(idea)}</div>` : ""}

          <div class="rowActions">
            ${quizCount ? `<button class="btn btnPrimary" type="button" data-quiz="${escapeHtml(node.id)}">PregÃºntame</button>` : ""}
            <span class="badge">EpÃ­grafe ${escapeHtml(node.id)}</span>
          </div>

          ${quizCount ? `
            <div class="quizBox">
              <div class="tag">Banco (cargado)</div>
              <div style="opacity:.85; font-size:13px">
                Tienes ${quizCount} preguntas en este epÃ­grafe.
              </div>
            </div>
          ` : ""}

          <div class="children" style="margin-top:10px; padding-left:14px; border-left:2px solid rgba(17,24,39,.08)"></div>
        </div>
      `;

      // âœ… Cierre inteligente: deja abierto ancestros + descendientes; cierra lo demÃ¡s
      d.addEventListener("toggle", () => {
        if(!d.open) return;

        const idActual = d.dataset.id;

        cont.querySelectorAll("details").forEach(other=>{
          if(other === d) return;
          const otherId = other.dataset.id;
          if(!otherId) return;

          const esDescDeActual = esDescendiente(otherId, idActual);
          const esAncestroDeActual = esDescendiente(idActual, otherId);

          if(!esDescDeActual && !esAncestroDeActual){
            other.open = false;
          }
        });
      });

      // Render hijos dentro del padre (cascada real)
      const childrenBox = d.querySelector(".children");
      node.children.forEach(ch=>{
        childrenBox.appendChild(renderNode(ch));
      });

      return d;
    }

    if(!heads.length){
      cont.innerHTML = `
        <div class="prio">
          <div class="tag">No se detectaron epÃ­grafes</div>
          <div style="opacity:.85">
            El detector busca lÃ­neas tipo <b>â€œ1. TÃTULOâ€</b> o <b>â€œ1.1. TÃTULOâ€</b> (con punto y espacio).<br><br>
            Primeros 300 caracteres del texto:<br><br>
            <code style="white-space:pre-wrap">${escapeHtml(PDF_TEXTO.slice(0,300))}</code>
          </div>
        </div>
      `;
    }else{
      roots.forEach(r=>cont.appendChild(renderNode(r)));
    }

    // Click de botones â€œPregÃºntameâ€
    cont.addEventListener("click", (e)=>{
      const btn = e.target.closest("button[data-quiz]");
      if(!btn) return;
      const id = btn.getAttribute("data-quiz");
      if(!id) return;
      startQuizForId(id);
    });

    /* =========================
       EVENTOS UI
    ========================= */
    btnCloseModal.addEventListener("click", closeModal);
    modalOverlay.addEventListener("click", (e)=>{
      if(e.target === modalOverlay) closeModal();
    });
    btnNextQuestion.addEventListener("click", renderQuestion);
    btnBlank.addEventListener("click", blankQuestion);

    document.addEventListener("keydown", (e)=>{
      if(!modalOverlay.classList.contains("show")) return;
      if(e.key === "Escape") closeModal();
      if(e.key === "Enter") renderQuestion();
    });

    btnTemaRandom.addEventListener("click", startQuizTema);
    btnSoloFalladas.addEventListener("click", startQuizFalladas);

    btnResetStats.addEventListener("click", ()=>{
      if(!confirm("Â¿Seguro que quieres borrar falladas y stats guardadas?")) return;
      STORE = { wrongUids: {}, stats: { ok:0, bad:0, blank:0 } };
      saveStore();
      refreshTemaStats();
      alert("Listo: reiniciado.");
    });

    // âœ… Arranque
    refreshTemaStats();
    renderScoreLine();

  } catch (err) {
    showErr("Error fatal: " + (err && err.message ? err.message : String(err)));
    if(diag){
      diag.innerHTML = `DiagnÃ³stico: <b>ERROR</b>`;
    }
  }
});
</script>
</body>
</html>